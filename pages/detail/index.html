<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AgroMarket</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
    rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <link rel="stylesheet" href="../detail/detail.css">
</head>

<body>
  <div class="container">
    <header class="d-flex justify-content-center py-3 border-bottom">
      <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
        <span class="fs-4"><em>AgroMarket</em></span>
      </a>
      <ul class="nav ">
        <li class="nav-item"><a href="/index.html" class="nav-link " aria-current="page"><i>Home</i></a></li>
        <li class="nav-item"><a href="index.html" class="nav-link"  style="border-bottom: solid white 0.5px ;"><i>Products</i></a></li>
      </ul>
    </header>
  </div>
  <div class="container" id="product-container">
    <!-- Product Information will be dynamically added here -->
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
const categoryId = params.get('category-id');
    const apiToken = '2e79eefd74136248b06f27da2fc503f057a6db43d166d27ac3cc8a20c3da67a1fc3de621e710b23a89ce1ac95fe44807daf44b7dc774e182c458a42b2acb7868fc3ddc6424f22a89d149c807b74d617d920a34b38a40743940e85c2a598e6b30a7117ecb70c2ecd77b54f6cfabbbed40e8acab56b91f545d309808338a948d18';
    const apiUrl = 'https://clever-eggs-512f1b05ad.strapiapp.com/api/products?populate=*&pagination[page]=1&pagination[pageSize]=34';

    document.addEventListener('DOMContentLoaded', () => {
        fetchAndDisplayProducts(apiUrl, 'product-container');
    });

    function fetchAndDisplayProducts(url, containerId) {
        fetch(url, {
            headers: {
                'Authorization': `Bearer ${apiToken}`
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('Complete response data:', data); // Log the complete response data
            if (!data || !data.data || data === 0) {
                console.log('No data found.');
            } else {
                displayProducts(data.data, containerId);
            }
        })
        .catch(error => console.error('Error:', error));
    }

    function displayProducts(products, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = ''; // Clear any existing content

        products.forEach(product => {
            const attributes = product.attributes;
            const imageUrl = attributes.images?.data?.attributes?.url || 'default-image-url.jpg'; // Fallback to default image if not available
            const productCard = `
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div id="carouselExample" class="carousel slide">
                            <div class="carousel-inner">
                                <div class="carousel-item active" >
                                    <img src="${imageUrl}" class="d-block w-100" alt="${attributes.name}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h2>${attributes.name}</h2>
                        <p>Price: $${attributes.price}</p>
                        <p>Quantity: ${attributes.quantity}</p>
                        <p>Organic: ${attributes.organic ? 'Yes' : 'No'}</p>
                        <p>Availability: ${attributes.availability}</p>
                        <p>Origin Province: ${attributes.originProvince}</p>
                        <hr>
                        <h3><b>Product Owner Contact Information</b></h3>
                        <p>Name: ${attributes.ownerName}</p>
                        <p>Email: ${attributes.ownerEmail}</p>
                        <p>Phone: ${attributes.ownerPhone}</p>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', productCard);
        });
    }
  </script>
</body>

</html>
